@{
    Layout = "";
    var Modulo = ViewContext.RouteData.Values["controller"].ToString() + "/" + ViewContext.RouteData.Values["action"].ToString();
}

<!doctype html>
<html lang="en" ng-app="mdDatetimePickerDemo">
<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png" />
    <link rel="icon" type="image/png" href="../assets/img/favicon.png" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Doutor Simples - Saúde ao seu Alcance</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
    <link rel="apple-touch-icon" sizes="57x57" href="../../Content/img/favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../../Content/img/favicons/apple-touch-icon-60x60.png">
    <link rel="icon" type="image/png" href="../../Content/img/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../Content/img/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="../../Content/img/favicons/manifest.json">
    <link rel="shortcut icon" href="../../Content/img/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#00a8ff">
    <meta name="msapplication-config" content="../../Content/img/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="../../Content/styles.css" />

    @Styles.Render("~/Content/doctorStyles/css")

    @if (Modulo == "Consulta/Index" ||
         Modulo == "Medico/Index")
    {
        <link href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" rel='stylesheet' type='text/css'>
        <link href="~/Content/doctorStyles/bootstrap-tagsinput.css" rel="stylesheet" />
    }

    @if (Modulo == "Agenda/Index")
    {
        <link href="../../Content/fullcalendar/fullcalendar.css" rel="stylesheet" type="text/css" />
        <link href="../../Content/spyner.css" rel="stylesheet" type="text/css" />
    }

    @if (Modulo == "Consulta/New")
    {
        <link href="https://fonts.googleapis.com/css?family=Roboto:400,500" rel='stylesheet' type='text/css'>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.0.0-rc3/angular-material.min.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="../../Content/material-datetimepicker.min.css" type="text/css" />
        <link href="../../Content/ConsultaNew.css" rel="stylesheet" type="text/css" />
    }

    <!-- Hotjar Tracking Code for doutorsimples.com.br -->
    <script>
        (function (h, o, t, j, a, r) {
            h.hj = h.hj || function () { (h.hj.q = h.hj.q || []).push(arguments) };
            h._hjSettings = { hjid: 612121, hjsv: 5 };
            a = o.getElementsByTagName('head')[0];
            r = o.createElement('script'); r.async = 1;
            r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
            a.appendChild(r);
        })(window, document, '//static.hotjar.com/c/hotjar-', '.js?sv=');
    </script>

    <!--     Fonts and icons     -->
    <link href="../../Content/font-awesome.min.css" rel="stylesheet">
    <link href="../../Content/font-Roboto.css" rel='stylesheet' type='text/css'>
</head>
<body ng-controller='DemoCtrl'>

    <div id="loading">
        <div id="spinner"></div>
    </div>

    <div id="myModal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="inbox-body">
                    @if (Modulo == "Consultorio/Confirma")  {

                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">×</button>
                            <h4>Confirmar Consulta</h4>
                        </div>
                        <div class="modal-body">
                            <form action="/Consulta/Create" method="post">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="ID_MediConsu" id="MediConsuClick" />
                                <input type="hidden" name="Data_Cons" id="DataClick" />
                                <input type="hidden" name="Hora_Cons" id="HoraClick" />

                                <div class="row">
                                    <div class="col-lg-12">
                                        <dt><div class="table-like"><b>Data:</b> </div>             <div id="Data_Consu" class="table-like">  </div> </dt>
                                        <dt><div class="table-like"><b>Médico:</b></div>            <div id="Medi_Consu" class="table-like">  </div> </dt>
                                        <dt><div class="table-like"><b>Consultório:</b></div>       <div id="Cons_Consu" class="table-like">  </div> </dt>
                                    </div>
                                    <div class="col-md-12">
                                        <button type="submit" value="Confirma" class="btn btn-primary pull-right">Confirmar</button>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <style>
                            .table-like {
                                display: inline-block;
                                margin: 0;
                                padding: 0;
                                min-width: 125px;
                            }

                            dt {
                                font-weight: normal;
                            }
                        </style>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="wrapper">
        <div class="sidebar" data-color="purple" data-image="../../Content/images/sidebar-1.jpg">
            <!--
                Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

                Tip 2: you can also add an image using data-image tag
            -->
            <div class="logo">
                <a href="http://www.creative-tim.com" class="simple-text">
                    Doutor Simples
                </a>
            </div>
            <div class="sidebar-wrapper">
                <ul class="nav">



                    @if (Modulo == "Home/Dashboard")
                    {
                        @Html.Raw("<li class=\"active\">");
                    }
                    else { @Html.Raw("<li>");
                    }

                    <a href="/Home/Dashboard">
                        <i class="material-icons">dashboard</i>
                        <p>Dashboard</p>
                    </a>

                    @Html.Raw("</li>")

                    @if (Modulo == "Consultorio/Edit")
                    {
                        @Html.Raw("<li class=\"active\">");
                    }
                    else { @Html.Raw("<li>");
                    }

                    <a href="/Consultorio/Edit/">
                        <i class="material-icons">local_hospital</i>
                        <p>Consultorio</p>
                    </a>

                    @Html.Raw("</li>")

                    @if (Modulo == "Consulta/Index")
                    {
                        @Html.Raw("<li class=\"active\">");
                    }
                    else {@Html.Raw("<li>");
                    }

                    <a href="/Consulta/">
                        <i class="material-icons">content_paste</i>
                        <p>Lista de Pacientes</p>
                    </a>

                    @Html.Raw("</li>")
                    <!-- <li>
                         <a href="#">
                             <i class="material-icons">library_books</i>
                             <p>Estatisticas</p>
                         </a>
                     </li>-->
                    @if (Modulo == "Medico/Index")
                    {
                        @Html.Raw("<li class=\"active\">");
                    }
                    else { @Html.Raw("<li>");
                    }
                    <a href="/Medico/">
                        <i class="material-icons">person</i>
                        <p>Gerenciar Médicos</p>
                    </a>
                    @Html.Raw("</li>")

                    @if (Modulo == "Consulta/New")
                    {
                        @Html.Raw("<li class=\"active\">");
                    }
                    else { @Html.Raw("<li>");
                    }
                    <a href="/Consulta/New/">
                        <i class="material-icons">schedule</i>
                        <p>Gerenciar Horarios</p>
                    </a>
                    @Html.Raw("</li>")
                    <!--  <li>
                          <a href="#">
                              <i class="material-icons">monetization_on</i>
                              <p>Fatura</p>
                          </a>
                      </li>-->

                </ul>

            </div>
        </div>
        <div class="main-panel">
            <nav class="navbar navbar-transparent navbar-absolute">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        @if (ViewContext.RouteData.Values["action"].ToString() == "Dashboard")
                        {
                            <a class="navbar-brand" href="#">Dashboard</a> }
                        @if (ViewContext.RouteData.Values["action"].ToString() == "Edit" &&
ViewContext.RouteData.Values["controller"].ToString() == "Consultorio")
                        {
                            <a class="navbar-brand" href="#">Perfil</a> }
                        @if (ViewContext.RouteData.Values["action"].ToString() == "Index" &&
ViewContext.RouteData.Values["controller"].ToString() == "Paciente")
                        {
                            <a class="navbar-brand" href="#">Lista de Pacientes</a> }
                        @if (ViewContext.RouteData.Values["action"].ToString() == "Index" &&
ViewContext.RouteData.Values["controller"].ToString() == "Medico")
                        {
                            <a class="navbar-brand" href="#">Medicos</a> }

                    </div>
                    <div class="collapse navbar-collapse">
                        <ul class="nav navbar-nav navbar-right">
                            <!--  <li>
                                  <a href="#pablo" class="dropdown-toggle" data-toggle="dropdown">
                                      <i class="material-icons">dashboard</i>
                                      <p class="hidden-lg hidden-md">Dashboard</p>
                                  </a>
                              </li>
                               <li class="dropdown">
                                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                      <i class="material-icons">notifications</i>
                                      <span class="notification">5</span>
                                      <p class="hidden-lg hidden-md">Notifications</p>
                                  </a>
                                  <ul class="dropdown-menu">
                                       <li><a href="#">Mike John responded to your email</a></li>
                                       <li><a href="#">You have 5 new tasks</a></li>
                                       <li><a href="#">You're now friend with Andrew</a></li>
                                       <li><a href="#">Another Notification</a></li>
                                       <li><a href="#">Another One</a></li>
                                   </ul>
                              </li>
                              <li>
                                  <a href="#pablo" class="dropdown-toggle" data-toggle="dropdown">
                                      <i class="material-icons">person</i>
                                      <p class="hidden-lg hidden-md">Profile</p>
                                  </a>
                              </li>-->
                            <li>
                                <a href="~/UsuarioConsultorios/Logoff">
                                    <i class="material-icons">exit_to_app</i>Sair
                                </a>
                            </li>

                        </ul>

                    </div>
                </div>
            </nav>
            <div class="content">
                <div class="container-fluid">
                    @RenderBody()
                </div>
            </div>
            <footer class="footer">
                <div class="container-fluid">
                    <nav class="pull-left">

                    </nav>

                </div>
            </footer>
        </div>
    </div>
</body>
<!--   Core JS Files   -->
@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")
@Scripts.Render("~/bundles/doctorScripts")
@Scripts.Render("~/bundles/inputmask")

<!--  Google Maps Plugin    -->

<script>
    $(document).ajaxStart(function () {
        $("#loading").attr("style", "visibility: visible");
    }).ajaxStop(function () {
        $("#loading").attr("style", "visibility: hidden");
    });
</script>

@if (Modulo == "Consulta/Index" ||
                             Modulo == "Medico/Index")
{
    <script src="~/Scripts/bootstrap-tagsinput.js" type="text/javascript"></script>
    <script src="~/Scripts/TypeHead.js" type="text/javascript"></script>

    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"> </script>

    <script>
        $(document).ready(function () {
            $('#tabela').DataTable({
                "searching": false,
                "info": false,
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/Portuguese-Brasil.json"
                }
            });
        });

        $("#Telefone_Medi").inputmask({ "mask": "(99) [9]9999-9999", "placeholder": "" });
        $("#CRM_Medi").inputmask({ "mask": "99999999-9", "placeholder": "" });
        $(document).on("ajaxComplete", function (e) {

            $("#Telefone_Medi").inputmask({ "mask": "(99) [9]9999-9999", "placeholder": "" });
            $("#CRM_Medi").inputmask({ "mask": "99999999-9", "placeholder": "" });

            $('input').on('keypress', function (e) {
                var code = null;
                code = (e.keyCode ? e.keyCode : e.which);
                return (code == 13) ? false : true;
            });


        });

        $('input').on('keypress', function (e) {
            var code = null;
            code = (e.keyCode ? e.keyCode : e.which);
            return (code == 13) ? false : true;
        });


    </script>
    <style>
        table.dataTable thead th {
            border-bottom: 1px solid #aaaaaa;
        }

        table.dataTable.no-footer {
            border-bottom: 1px solid #aaaaaa;
        }
    </style>
}

@if (Modulo == "Agenda/Index")
{
    <script src='../../Scripts/fullcalendar/lib/moment.min.js'></script>
    <script src='../../Scripts/fullcalendar/fullcalendar.min.js'></script>
    <script src='../../Scripts/fullcalendar/pt-br.js'></script>

    <script>
        $(document).ready(function () {
            // Javascript method's body can be found in assets/js/demos.js

            var calenEvents = [];

            demo.initDashboardPageCharts();
            $('#calendar').fullCalendar({
                header: {
                    left: '',
                    center: '',
                    right: ''
                },
                navLinks: true,
                selectable: true,
                selecHelper: true,
                disableDragging: true,
                select: function (start, end) {

                    var title = "Consulta";
                    var eventData;
                    if (title) {
                        eventData = {
                            title: title,
                            start: start,
                            end: end,
                            durationEditable: false,
                            overlap: false
                        };

                        var eventObjeto = { allday: "", start: eventData.start.format(), end: eventData.end.format() };

                        calenEvents.push(eventObjeto);
                        $('#calendar').fullCalendar('renderEvent', eventData, true);
                    }

                    console.log(calenEvents);

                    $('#calendar').fullCalendar('unselect');
                },

                /*eventClick: function(calEvent, jsEvent, view){
                    alert("Event:" + calEvent.title);
                    alert("Coordinates:" + jsEvent.pageX + ',' + jsEvent.pageY);
                    alert("View:" + view.name);

                    $(this).css('border-color', 'red');
                },*/

                eventRender: function (event, element) {
                    element.on('click', function () {

                        var x = calenEvents.indexOf(this);

                        calenEvents = $.grep(calenEvents, function (e) {

                            return e.start != event.start.format().substring(0, 19);
                        });


                        $('#calendar').fullCalendar('removeEvents', event._id);

                        console.log(calenEvents);
                    });
                },

                editable: true,

                eventLimit: true,
                views: {
                    settimana: {
                        type: 'agendaWeek',
                        duration: {
                            days: 7
                        },
                        columnFormat: 'dddd'
                    }
                },

                events: {
                    url: '../../Agenda/GetEvents',
                    type: 'POST',
                    data: {
                        ID_MediConsul: '@ViewBag.ID_MediConsul'
                    },

                    success: function (data) {
                        for (var y = 0; y < data.length; ++y) {

                            var eventObjeto = { allday: data[y].allday, start: data[y].start.substring(0, 19), end: data[y].end.substring(0, 19) };
                            calenEvents.push(eventObjeto);
                        }

                    },

                    error: function () {
                        //alert('xablaw');
                    }
                },

                /*  eventDrop: function checkOverlap(event) {

                      var start = new Date(event.start);
                      var end = new Date(event.end);

                      var overlap = $('#calendar').fullCalendar('clientEvents', function(ev) {
                          if( ev == event)
                              return false;
                          var estart = new Date(ev.start);
                          var eend = new Date(ev.end);

                          return (Math.round(estart)/1000 < Math.round(end)/1000 && Math.round(eend) > Math.round(start));
                      });

                      if (overlap.length){
                          //either move this event to available timeslot or remove it
                      }
                  },*/

                selectOverlap: function (event) {
                    if (event.ranges && event.ranges.length > 0) {
                        return (event.ranges.filter(function (range) {
                            return (event.start.isBefore(range.end) &&
                                    event.end.isAfter(range.start));
                        }).length) > 0;
                    }
                    else {
                        return !!event && event.overlap;
                    }
                },

                allDaySlot: false,
                disableResizing: true,

                defaultDate: '2017-07-09',
                defaultView: 'settimana'
            });

            $("#submit").on("click", function (event) {
                event.preventDefault();

                var form = document.getElementById("cadastrar");

                var veriToken = $('input[name="__RequestVerificationToken"]', form).val();
                var ID_MediConsul = $('#ID_MediConsul').val();
                var Redirect = $("#Redirect").val();

                //Pega a Action do Form.
                var modulo = $("#cadastrar").attr("action");

                $.ajax({
                    url: modulo,
                    type: 'POST',
                    dataType: "json",
                    data: { 'events': calenEvents, '__RequestVerificationToken': veriToken, 'ID_MediConsul': ID_MediConsul, 'Redirect': Redirect },
                    success: function (response) {
                        if (response && response.success) {

                            if (response.result == "Save") {
                                window.location = "../../Consultorio/Edit";
                            }

                            if (response.result == "MultipleSave") {
                                window.location = "../../Medico/New";
                            }

                            if (response.result == "Conclusion") {
                                window.location = "../../Medico/Index";
                            }
                            //console.log(response);


                        } else {

                            console.log(response);

                        }

                    }, error: function (x, y, err) {
                        /*   alert("Operação não efetuada!");
                           alert(x);
                           alert(y);
                           alert(err);*/
                    }
                });

            });
        });
    </script>

}

@if (Modulo == "Consultorio/Edit")
{
    @Scripts.Render("~/bundles/inputmask")

    <script>
        $(document).ready(function () {
            $("#Telefone_Consu").inputmask({ "mask": "(99) [9]9999-9999", "placeholder": "" });
            $("#CEP_Consu").inputmask({ "mask": "99999-999", "placeholder": "" });
            $("#CPF_Consu").inputmask({ "mask": "999.999.999-99", "placeholder": "" });
            $("#CNPJ_Consu").inputmask({ "mask": "99.999.999/9999-99", "placeholder": "" });
        });
    </script>


    <script>
        $(document).ready(function () {

            $("#CEP_Consu").on("keypress", function (e) {
                if ($("#CEP_Consu").val().length == 8 && e.keyCode != 9) {
                    e.preventDefault();
                    return false;
                }
            });

            $("#CPF_Consu").on("keypress", function (e) {
                if ($("#CPF_Consu").val().length == 15 && e.keyCode != 9) {
                    e.preventDefault();
                    return false;
                }
            });

            $("#RG_Consu").on("keydown", function (e) {
                if ($("#RG_Consu").val().length == 9 && e.keyCode != 9) {
                    e.preventDefault();
                    return false;
                }
            });

            $("#Telefone_Consu").on("keypress", function (e) {
                if ($("#Telefone_Consu").val().length == 14 && e.keyCode != 9) {
                    e.preventDefault();
                    return false;
                }
            });

            $("#CNPJ_Consu").on("keypress", function (e) {
                if ($("#CNPJ_Consu").val().length == 15 && e.keyCode != 9) {
                    e.preventDefault();
                    return false;
                }
            });

            /* $(document).ajaxStart(function () {
                 $("#loading").attr("style", "visibility: visible");
             }).ajaxStop(function () {
                 $("#loading").attr("style", "visibility: hidden");
             });*/


            $("#CEP_Consu").on("blur", function () {

                var url = "https://viacep.com.br/ws/" + $("#CEP_Consu").val().replace(/\D/g, '') + "/json/?callback=";


                $.ajax({
                    url: url,
                    type: 'GET',
                    success: function (dados) {

                        var end = dados.logradouro + " " + dados.complemento;

                        if (dados.erro != true) {
                            $("#Cidade_Consu").val(dados.localidade);
                            $("#Estado_Consu").val(dados.uf);
                            $("#Endereco_Consu").val(end);
                            $("#Bairro_Consu").val(dados.bairro);

                            $("#Cidade_Consu").parent().removeClass("is-empty");
                            $("#Estado_Consu").parent().removeClass("is-empty");
                            $("#Endereco_Consu").parent().removeClass("is-empty");
                            $("#Bairro_Consu").parent().removeClass("is-empty");

                        } else {
                            $("#Cidade_Paci").val("");
                            $("#Estado_Paci").val("");
                            $("#Endereco_Paci").val("");
                            $("#Bairro_Consu").val("");
                        }


                    }, error: function (x, y, err) {
                        alert("Operação não efetuada");
                    }
                });

            });

            $("#edit").validate({
                rules:
                {
                    Email_Consu:
                    {
                        required: true,
                        minlength: 10,
                        email: true
                    },
                    Nome_Consu:
                    {
                        required: true,
                        minlength: 5
                    },
                    Telefone_Consu:
                    {
                        minlength: 14
                    },
                    CEP_Consu:
                    {
                        required: true,
                        minlength: 8
                    },
                    Endereco_Consu:
                    {
                        required: true,
                        minlength: 5
                    },
                    Cidade_Consu:
                    {
                        required: true,
                        minlength: 5
                    },
                    Estado_Consu:
                    {
                        required: true,
                        minlength: 2
                    },
                    CNPJ_Consu:
                    {
                        required: true,
                        minlength: 12
                    },
                    Razao_Consu:
                    {
                        required: true,
                        minlength: 4
                    },
                    Senha_UsuCons:
                    {
                        required: true,
                        minlength: 5
                    },
                    Confirma_UsuCons:
                    {
                        required: true,
                        minlength: 5,
                        equalTo: "#Senha_UsuPaci"
                    },
                    Responsavel_Consu:
                    {
                        required: true,
                        minlength: 5
                    }
                },
                messages:
                {
                    Responsavel_Consu:
                    {
                        required: "Campo Responsável necessário"
                    },
                    Email_Consu:
                    {
                        required: "Campo E-Mail necessário",
                        minlength: jQuery.validator.format("Por favor, insira ao menos 10 caracteres"),
                        email: "Por favor, entre com um E-mail válido"
                    },
                    Nome_Consu:
                    {
                        required: "Campo Nome necessário",
                        minlength: jQuery.validator.format("Por favor, insira ao menos 5 caracteres")
                    },
                    Telefone_Consu:
                    {
                        minlength: jQuery.validator.format("Por favor, insira ao menos 10 caracteres")
                    },
                    CEP_Consu:
                    {
                        required: "Campo CEP necessário",
                        minlength: jQuery.validator.format("Por favor, insira ao menos 8 caracteres")
                    },
                    Endereco_Consu:
                    {
                        required: "Campo Endereço necessário",
                        minlength: jQuery.validator.format("Por favor, insira ao menos 5 caracteres")
                    },
                    Cidade_Consu:
                    {
                        required: "Campo Cidade necessário",
                        minlength: jQuery.validator.format("Por favor, insira ao menos 5 caracteres")
                    },
                    Estado_Consu:
                    {
                        required: "Campo Estado necessário",
                        minlength: jQuery.validator.format("Por favor, insira ao menos 2 caracteres")
                    },
                    CNPJ_Consu:
                    {
                        required: "Campo CNPJ necessário",
                        minlength: jQuery.validator.format("Por favor, insira ao menos 5 caracteres")
                    },
                    Razao_Consu:
                    {
                        required: "Campo Razao necessário",
                        minlength: jQuery.validator.format("Por favor, insira ao menos 4 caracteres")
                    },
                    Senha_UsuCons:
                    {
                        required: "Por favor insira a Senha",
                        minlength: "Senha muito curta"
                    },
                    Confirma_UsuCons:
                    {
                        required: "Por favor confirme sua Senha",
                        minlength: "Senha muito curta",
                        equalTo: "Senhas não coincidem"
                    }
                }
            });

        });
    </script>
    <style>
        .error {
            color: #c13434 !important;
        }
    </style>

    if (ViewBag.Sucesso != null)
    {        
      <script>
          $('.alert').addClass('alert-success');
          $('.alert').append('Dados Atualizados.');
          $('.alert').css('padding', '15');

          $(".alert").alert();
      </script>        
    }

}

@if (Modulo == "Consulta/New" ||
     Modulo == "Home/Dashboard" ||
     Modulo == "Consultorio/Confirma")
{

    Scripts.Render("~/bundles/date");

    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular-animate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular-aria.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.0.0-rc3/angular-material.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment-with-locales.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>


    <script type="text/javascript" src="../../Scripts/consulConfirma/beautifier.js"></script>
    <script type="text/javascript" src="../../Scripts/consulConfirma/angular-material-datetimepicker.js"></script>
    <script type="text/javascript" src="../../Scripts/consulConfirma/demo.js"></script>

}

@if (Modulo == "Consultorio/Confirma")
{
    <script>

        $(document).on('click', '#ChangeDate', function () {
            setTimeout(function(){
                $("#Data_Cons").trigger("change");
            }, 500);
        });

        $(document).on('click', 'a.dtp-select-day.selected', function () {
            setTimeout(function () {
                $("#Data_Cons").trigger("change");
            }, 500);
        });

        $(document).on('change', "#ID_MediConsu", function () {
            $("#Data_Cons").trigger("change");
        });

        $("#Data_Cons").trigger("change");

        $(document).on("click", "#openModal", function(){
            $("#DataClick").val($("#Data_Cons").val());
            $("#HoraClick").val($(this).val());
            $("#MediConsuClick").val($("#ID_MediConsu").val());

            $("#Data_Consu").html($("#Data_Cons").val() +" - "+ $(this).val());
            $("#Medi_Consu").html($("#ID_MediConsu").html());
            $("#Cons_Consu").html($("#consuContent").html());

            $("#myModal").modal('toggle');
        });

        $("#iconClick").on("click", function(){
            $("#Data_Cons").focus();
        });

        $("#Data_Cons").change( function () {

            var dataCons = $("#Data_Cons").val();
            var dataId   = $("#ID_MediConsu").val();

            $.ajax({
                type: 'POST',
                url: '../../Paciente/jSonConsult',
                data: { Data_Cons: dataCons, id: dataId },
                success: function (response) {

                    if (response && response.success) {

                        $('#conteuHorar').html('');
                        $('#conteuHorar').append('<center>');

                        for (var i = 0; i < response.consult.length; ++i) {

                            $('#conteuHorar').append('<button id="openModal" class="btn btn-primary" btn-block data-background-color="green" name="Hora_Cons" value=' +
                                response.consult[i].DtCons + '>'+response.consult[i].DtCons+'</button>');

                        }

                        if(response.consult.length == 0){
                            $('#conteuHorar').append('Sentimos muito, mas não existem horários vagos neste dia :(');
                        }

                        $('#conteuHorar').append('</center>');
                    }

                }
            });
        });

        $(document).ready(function () {
            $("#Data_Cons").trigger("change");
        });

    </script>
}

@if (Modulo == "Consulta/New")
{
    <script type="text/javascript">

        function check(ele) {
            var id = ele.id;
            if (document.getElementById(id).classList.contains('btnativo')) {
                document.getElementById(id).classList.remove('btnativo');
            } else {
                document.getElementById(id).classList.add('btnativo');
            }
        }

        $("#cleamAll").on('click', function () {
            $('.btnativo').each(function () {
                $(this).removeClass('btnativo');
            });
        });

        $(document).on('change', "#ID_MediConsu", function () {
            $("#Data_Cons").trigger("change");
        });

        $(document).on('click', '#ChangeDate', function () {
            setTimeout(function () {
                $("#Data_Cons").trigger("change");
            }, 500);
        });

        $(document).on('click', 'a.dtp-select-day.selected', function () {
            setTimeout(function () {
                $("#Data_Cons").trigger("change");
            }, 500);
        });

        $('#sendAgenda').on('click', function () {
            var arrayAgenda = [];
            var active;

            $("#conteuHorar").children('.btn-primary').each(function () {

                if ($(this).hasClass("btnativo")) {
                    active = false;
                } else {
                    active = true;
                }

                arrayAgenda.push(
                    {
                        ID_Agenda: $(this).val(),
                        Data_Agenda: $("#" + $(this).val()).val(),
                        DSeman_Agenda: $("#DSeman_Agenda").val(),
                        ID_MediConsul: $("#ID_MediConsu").val(),
                        ativo: active
                    });
            });


            $.ajax({
                type: 'POST',
                url: '../../Consulta/jsonConsultAtt',
                data: { arrAgenda: arrayAgenda },
                success: function (response) {

                    if (response) {
                        $('.alert').addClass('alert-success');
                        $('.alert').append('Horários Atualizados.');
                        $('.alert').css('padding', '15');
                    } else {
                        $('.alert').addClass('alert-warning');
                        $('.alert').append('Horários não Atualizados.');
                        $('.alert').css('padding','15');
                    }

                    $(".alert").alert();
                }
            });

        });

        $("#Data_Cons").change(function () {

            var dataCons = $("#Data_Cons").val();
            var dataId = $("#ID_MediConsu").val();

            $.ajax({
                type: 'POST',
                url: '../../Consulta/jSonConsulNew',
                data: { Data_Cons: dataCons, id: dataId },
                success: function (response) {

                    if (response && response.success) {

                        $('#conteuHorar').html('');
                        $('#conteuHorar').append('<center>');

                        if (response.consult.length > 0) {
                            $('#conteuHorar').append('<input type=hidden id="DSeman_Agenda" value="' + response.consult[0].DoW + '">');
                        }

                        for (var i = 0; i < response.consult.length; ++i) {

                            if (response.consult[i].Ativo) {
                                $('#conteuHorar').append('<button class="btn btn-primary" btn-block data-background-color="green" name="Hora_Cons" value="' +
                                    response.consult[i].AgendaId + '"id="btnHorar' + response.consult[i].AgendaId + '" onclick="check(this);">' +
                                    response.consult[i].DtCons + '</button>');
                            } else {
                                $('#conteuHorar').append('<button class="btn btn-primary btnativo" btn-block data-background-color="green" name="Hora_Cons" value="' +
                                   response.consult[i].AgendaId + '"id="btnHorar' + response.consult[i].AgendaId + '" onclick="check(this);">' +
                                   response.consult[i].DtCons + '</button>');
                            }

                            $('#conteuHorar').append('<input type=hidden id="' + response.consult[i].AgendaId + '" value="' + response.consult[i].DAgen + '">');

                        }

                        $('#conteuHorar').append('</center>');
                    }

                }
            });
        });

        /*$(document).ajaxStart(function () {
            $("#loading").attr("style", "visibility: visible");
        }).ajaxStop(function () {
            $("#loading").attr("style", "visibility: hidden");
        });*/

        $(document).ready(function () {
            $("#Data_Cons").trigger("change");
        });


    </script>
}

@RenderSection("scripts", required: false)

</html>